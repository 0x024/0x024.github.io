---
layout: post
title:  "关于学校网站绕过验证，下载全部学生档案漏洞"
date:   2017-04-20 13:50:39
categories: bug
---
# 0x01：前言

闲来无事，对咱们学校搭建的新的网站 http://www.my.hasut.edu.cn 比较感兴趣，因为它真的突破了许多.edu.cn网站的呆板的布局，看着就让人舒服。

新的事物，往往是最引人入胜的，提供了各种便捷的接口，比如查看课程成绩，图书借阅，一卡通余额等，然而简单地说，这个世界上基本不存在完美的东西，网站也是一样的。随之而来的就是一些隐藏在深处的漏洞。对于一些不法分子（传说中的黑客），通过网络利用系统漏洞等方式非法植入对方计算机系统，一旦进入计算机中，用户的主机就被黑客完全利用，成为黑客的超级用户，黑客程序可以被用来窃取密码、令、帐号、阻塞用户、电子邮件骚扰、篡改网页、破坏程序等行为，对用户主机安全构成严重威胁
因此，从中获取不正当的利益，

在此声明：我进行的以下演示，只是为了友好的检测网站的漏洞，为了网站的安全建设，提供微不足道的贡献，

# 0x02： 演示

进入学校的官网，河南科技大学智慧校园，界面真的挺简洁的。给人以清爽的感觉！

![](http://123.206.56.205/image/2017-04-20/Screenshot%20from%202017-04-16%2015-20-23.png) 

网站搭建出于安全的考虑，真正提交表格的往往并不是并不是显示在地址栏的网址，
![](http://123.206.56.205/image/2017-04-20/Screenshot%20from%202017-04-16%2015-57-52.png) 
分析一下。打开F12，审查元素，分析代码，查看Network选项，发现有三个比较可疑的地址。

接下来就是一个一个的尝试，经过实验后发现

```
http://my.haust.edu.cn/cas/login?service=http://210.43.0.37:8080/xgxt/home/xgsyPage.action
```
才是真正提交账户信息的网址，这就好说了，直接在游览器中打开该网址，在里面输入username 和password

但是这里就发生一个比较有趣的事情！提交表格的是上诉的地址，但是显示表格的确是
```
http://210.43.0.37:8080/xgxt/home/mainPage.action
```

![](http://123.206.56.205/image/2017-04-20/Screenshot%20from%202017-04-16%2016-21-41.png) 


网站里面最重要的信息莫过于学号，家庭住址，身份证信息等，但是获取这些必须知道登录的帐号密码，这方面的安全，就做的比较好！

但是对于学生档案图片的获取，网站在编写的时候并没注意到这个漏洞！

![](http://123.206.56.205/image/2017-04-20/Screenshot%20from%202017-04-16%2016-35-56.png) 


看到在审查元素的时候，该页面已经将所有的js,cd,html资源下载到缓存中,不过发现，学生图片存储的方式并不是常规的.jpg或者.png为后缀名的图片，继续打开图片所在的
![](http://123.206.56.205/image/2017-04-20/Screenshot%20from%202017-04-16%2016-37-36.png) 

发现时乱码，这也是正常的，这或许是对照片的一种安全的保护吧！

或许是出于好奇，看到学生图片指示URL是个很规范的链接，并没进行什么加密，所以，我就想，是否修改一下最后的学号，就可以返回不同的照片，试了一下后，结果竟然跳过了cookies的检测，直接得到了对应学号的学生图片。

在这之前，也测试过教务系统三的里学生图片信息，发现其图片存储的方式会在URL最后加上一串随机字符，这就更好地保障了图片信息不会被轻而易举的爬取，

# 0x03：获取
对于人工的照片的获取，一套流程已经下来，
	Step1:打开网站
	step2:输入帐号密码
	step3:获取cookies
	step4:转跳到图片URL
	step5:修改最后URL最后的学号
	step6:将乱码编码
	step7:将编码厚的图片下载到本地

利用python写的脚本，实现人工的操作，直接将所有的学生的照片下载到本地，
脚本中
![](http://123.206.56.205/image/2017-04-20/Screenshot%20from%202017-04-16%2016-46-49.png) 

得到的结果如图所示。只是获取了随机的一部分学号。

![](http://123.206.56.205/image/2017-04-20/Screenshot%20from%202017-04-16%2016-57-03.png) 

# 0x04 结束
**网站有漏洞并不可怕，可怕的是明知有漏而不去弥补**